<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Prueba Open Food Facts con Backend</title>
</head>
<body>
  <h1>Buscar producto por código de barras</h1>

  <input type="text" id="barcodeInput" placeholder="Introduce código de barras" />
  <button onclick="buscarProducto()">Buscar</button>

  <div id="resultado" style="margin-top: 20px;"></div>

  <script>
    async function buscarProducto() {
      const barcode = document.getElementById('barcodeInput').value.trim();
      const resultadoDiv = document.getElementById('resultado');

      if (!barcode) {
        resultadoDiv.innerHTML = "<p style='color:red;'>Introduce un código de barras válido.</p>";
        return;
      }

      resultadoDiv.innerHTML = "<p>Buscando...</p>";

      const url = `http://localhost:3000/producto/${barcode}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.status == 1) {
          const producto = data.product;

          resultadoDiv.innerHTML = `
            <h2>${producto.product_name || 'Sin nombre'}</h2>
            <p><strong>Marca:</strong> ${producto.brands || 'No especificado'}</p>
            <p><strong>Ingredientes:</strong> ${producto.ingredients_text || 'No disponible'}</p>
            <p><strong>Alérgenos:</strong> ${producto.allergens || 'No especificado'}</p>
            ${producto.image_url ? `<img src="${producto.image_url}" alt="Imagen del producto" width="200">` : ''}
          `;
        } else {
          resultadoDiv.innerHTML = "<p style='color:red;'>Producto no encontrado en Open Food Facts.</p>";
        }
      } catch (error) {
        console.error("Error al obtener el producto:", error);
        resultadoDiv.innerHTML = "<p style='color:red;'>Error al conectar con la API.</p>";
      }
    }
  </script>
</body>
</html>
